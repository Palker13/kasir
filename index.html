<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kasir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF & html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="KasirApp">
    <meta name="msapplication-TileImage" content="icon-192.png">
    <meta name="msapplication-TileColor" content="#1e40af">
    <meta name="theme-color" content="#1e40af">
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('SW registered: ', reg))
                    .catch(err => console.error('SW registration failed: ', err));
            });
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-600 to-indigo-800 min-h-screen flex items-center justify-center font-[Inter]">
    <!-- Login Screen -->
    <div id="login-screen" class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Welcome <span class="text-blue-600">Back</span></h1>
            <p class="text-gray-500 mt-2">Sign in to your account</p>
        </div>
        <form id="login-form" class="space-y-6">
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                <input type="text" id="username" name="username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                <input type="password" id="password" name="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
            </div>
            <div class="flex flex-col space-y-3">
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Sign in
                </button>
                <button type="button" id="register-btn" class="w-full flex justify-center py-2 px-4 border border-blue-600 rounded-md shadow-sm text-sm font-medium text-blue-600 bg-white hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Register
                </button>
            </div>
            <div class="text-sm text-center text-gray-500">
                <p>Demo credentials:</p>
                <p>Username: demo / Password: password</p>
            </div>
        </form>
    </div>

    <!-- Registration Modal -->
    <div id="register-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="register-form" class="space-y-4">
                <div>
                    <label for="reg-username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="reg-username" name="reg-username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="reg-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="reg-email" name="reg-email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="reg-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="reg-password" name="reg-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="reg-confirm-password" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                    <input type="password" id="reg-confirm-password" name="reg-confirm-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="pt-4">
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Create Account
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="hidden w-full min-h-screen bg-gray-100">
        <div class="bg-white shadow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-xl font-bold text-blue-600">Dashboard</h1>
                        </div>
                        <nav class="ml-6 flex space-x-8">
                            <a href="#" id="nav-home" class="border-blue-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Home
                            </a>
                            <a href="#" id="nav-profile" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Profile
                            </a>
                            <a href="#" id="nav-settings" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Settings
                            </a>
                            <a href="#" id="nav-cashier" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Cashier
                            </a>
                        </nav>
                    </div>
                    <div class="flex items-center">
                        <div class="ml-3 relative">
                            <div>
                                <button id="user-menu-button" type="button" class="bg-white flex text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" aria-expanded="false" aria-haspopup="true">
                                    <span class="sr-only">Open user menu</span>
                                    <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                        <span id="user-initial" class="text-blue-600 font-medium">U</span>
                                    </div>
                                </button>
                            </div>
                            <div id="user-dropdown" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                                <a href="#" id="profile-link" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Your Profile</a>
                                <a href="#" id="settings-link" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Settings</a>
                                <a href="#" id="logout-button" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Sign out</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Home Section -->
            <div id="home-section" class="px-4 py-6 sm:px-0">
                <div class="border-4 border-dashed border-gray-200 rounded-lg p-6 h-auto flex flex-col items-center justify-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Welcome to your Dashboard</h2>
                    <p class="text-gray-600 text-center max-w-md mb-6">You've successfully logged in! This is your home dashboard where you can access all features.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-4xl">
                        <div class="bg-white p-4 rounded-lg shadow cursor-pointer hover:shadow-md transition-shadow" id="analytics-card">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-blue-100 rounded-md p-3">
                                    <i class="fas fa-chart-line text-blue-600"></i>
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-lg font-medium text-gray-900">Analytics</h3>
                                    <p class="text-sm text-gray-500">View your statistics</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow cursor-pointer hover:shadow-md transition-shadow" id="users-card">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-green-100 rounded-md p-3">
                                    <i class="fas fa-users text-green-600"></i>
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-lg font-medium text-gray-900">Users</h3>
                                    <p class="text-sm text-gray-500">Manage your users</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow cursor-pointer hover:shadow-md transition-shadow" id="settings-card">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-purple-100 rounded-md p-3">
                                    <i class="fas fa-cog text-purple-600"></i>
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-lg font-medium text-gray-900">Settings</h3>
                                    <p class="text-sm text-gray-500">Configure your account</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow cursor-pointer hover:shadow-md transition-shadow" id="cashier-card">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-amber-100 rounded-md p-3">
                                    <i class="fas fa-cash-register text-amber-600"></i>
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-lg font-medium text-gray-900">Cashier</h3>
                                    <p class="text-sm text-gray-500">Open POS system</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile-section" class="px-4 py-6 sm:px-0 hidden">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">User Profile</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Personal details and information</p>
                    </div>
                    <div class="border-t border-gray-200">
                        <dl>
                            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Full name</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-name">Demo User</dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Username</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-username">demo</dd>
                            </div>
                            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Email address</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="profile-email">demo@example.com</dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Account created</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">January 1, 2023</dd>
                            </div>
                        </dl>
                    </div>
                    <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
                        <button type="button" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" id="edit-profile-btn">
                            Edit Profile
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="px-4 py-6 sm:px-0 hidden">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Account Settings</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Manage your preferences and security settings</p>
                    </div>
                    <div class="border-t border-gray-200">
                        <form id="settings-form" class="divide-y divide-gray-200">
                            <div class="px-4 py-5 space-y-4 sm:p-6">
                                <div>
                                    <h4 class="text-md font-medium text-gray-900">Notifications</h4>
                                    <div class="mt-4 space-y-2">
                                        <div class="flex items-start">
                                            <div class="flex items-center h-5">
                                                <input id="email-notifications" name="email-notifications" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                                            </div>
                                            <div class="ml-3 text-sm">
                                                <label for="email-notifications" class="font-medium text-gray-700">Email notifications</label>
                                                <p class="text-gray-500">Get notified via email about account activity</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start">
                                            <div class="flex items-center h-5">
                                                <input id="marketing-emails" name="marketing-emails" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                            </div>
                                            <div class="ml-3 text-sm">
                                                <label for="marketing-emails" class="font-medium text-gray-700">Marketing emails</label>
                                                <p class="text-gray-500">Receive emails about new features and offers</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pt-6">
                                    <h4 class="text-md font-medium text-gray-900">Privacy</h4>
                                    <div class="mt-4 space-y-2">
                                        <div class="flex items-start">
                                            <div class="flex items-center h-5">
                                                <input id="public-profile" name="public-profile" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded">
                                            </div>
                                            <div class="ml-3 text-sm">
                                                <label for="public-profile" class="font-medium text-gray-700">Public profile</label>
                                                <p class="text-gray-500">Make your profile visible to other users</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pt-6">
                                    <h4 class="text-md font-medium text-gray-900">Theme</h4>
                                    <div class="mt-4">
                                        <select id="theme-select" name="theme" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                                            <option value="light">Light</option>
                                            <option value="dark">Dark</option>
                                            <option value="system">System Default</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="pt-6">
                                    <h4 class="text-md font-medium text-gray-900">Data Synchronization</h4>
                                    <div class="mt-4 space-y-2">
                                        <div class="flex items-start">
                                            <div class="flex items-center h-5">
                                                <input id="sync-enabled" name="sync-enabled" type="checkbox" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded" checked>
                                            </div>
                                            <div class="ml-3 text-sm">
                                                <label for="sync-enabled" class="font-medium text-gray-700">Enable cloud synchronization</label>
                                                <p class="text-gray-500">Keep your data synchronized across all devices</p>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center mt-2">
                                            <span class="text-sm text-gray-700">Last synced:</span>
                                            <span id="last-synced" class="text-sm text-gray-500">Never</span>
                                        </div>
                                        <button type="button" id="force-sync-btn" class="mt-2 inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                            <i class="fas fa-sync-alt mr-2"></i> Sync Now
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
                                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    Save Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="px-4 py-6 sm:px-0 hidden">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Analytics Dashboard</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">View your performance metrics and statistics</p>
                    </div>
                    <div class="border-t border-gray-200 p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-blue-800 uppercase tracking-wide">Total Views</h4>
                                <p class="mt-1 text-3xl font-semibold text-blue-600">1,245</p>
                                <p class="mt-1 text-sm text-blue-500">
                                    <span class="text-green-500"><i class="fas fa-arrow-up"></i> 12%</span> from last month
                                </p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-green-800 uppercase tracking-wide">Engagement</h4>
                                <p class="mt-1 text-3xl font-semibold text-green-600">87%</p>
                                <p class="mt-1 text-sm text-green-500">
                                    <span class="text-green-500"><i class="fas fa-arrow-up"></i> 3%</span> from last month
                                </p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-purple-800 uppercase tracking-wide">Conversion</h4>
                                <p class="mt-1 text-3xl font-semibold text-purple-600">5.2%</p>
                                <p class="mt-1 text-sm text-purple-500">
                                    <span class="text-red-500"><i class="fas fa-arrow-down"></i> 1%</span> from last month
                                </p>
                            </div>
                        </div>
                        <div class="mt-8 h-64 bg-gray-100 rounded-lg flex items-center justify-center">
                            <p class="text-gray-500">Chart visualization would appear here</p>
                        </div>
                        <div class="mt-4 flex justify-end">
                            <button type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" id="export-analytics-btn">
                                <i class="fas fa-download mr-2"></i> Export Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="px-4 py-6 sm:px-0 hidden">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">User Management</h3>
                            <p class="mt-1 max-w-2xl text-sm text-gray-500">View and manage user accounts</p>
                        </div>
                        <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" id="add-user-btn">
                            <i class="fas fa-plus mr-2"></i> Add User
                        </button>
                    </div>
                    <div class="border-t border-gray-200">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="users-table-body">
                                    <!-- User rows will be dynamically generated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cashier Section -->
            <div id="cashier-section" class="px-4 py-6 sm:px-0 hidden">
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Cashier System</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Point of Sale Application</p>
                    </div>
                    <div class="border-t border-gray-200">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6">
                            <!-- Product Selection -->
                            <div class="lg:col-span-2">
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-4">
                                        <h4 class="text-lg font-medium text-gray-900">Products</h4>
                                        <div class="flex items-center space-x-2">
                                            <div class="relative">
                                                <input type="text" id="product-search" placeholder="Search products..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                    <i class="fas fa-search text-gray-400"></i>
                                                </div>
                                            </div>
                                            <button id="add-product-btn" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                <i class="fas fa-plus mr-2"></i> Add Product
                                            </button>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="product-grid">
                                        <!-- Product items will be dynamically generated -->
                                    </div>
                                </div>
                            </div>
                            <!-- Cart -->
                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <h4 class="text-lg font-medium text-gray-900 mb-4">Current Order</h4>
                                <div class="overflow-y-auto max-h-80 mb-4">
                                    <table class="min-w-full divide-y divide-gray-200" id="cart-table">
                                        <thead class="bg-gray-100">
                                            <tr>
                                                <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                                                <th scope="col" class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                                <th scope="col" class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                                <th scope="col" class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="cart-items">
                                            <!-- Cart items will be dynamically added here -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="border-t border-gray-200 pt-4 space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Subtotal:</span>
                                        <span class="font-medium" id="subtotal">Rp 0</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700">Discount:</span>
                                        <div class="flex items-center">
                                            <input type="number" id="discount-amount" step="1" class="w-24 px-2 py-1 text-right border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm" placeholder="0">
                                            <button id="apply-discount-btn" class="ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded-md text-xs hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                Apply
                                            </button>
                                        </div>
                                    </div>
                                    <div class="flex justify-between text-lg font-bold">
                                        <span>Total:</span>
                                        <span id="total">Rp 0</span>
                                    </div>
                                </div>
                                <div class="mt-6 space-y-3">
                                    <button type="button" id="checkout-btn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fas fa-credit-card mr-2"></i> Checkout
                                    </button>
                                    <button type="button" id="clear-cart-btn" class="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fas fa-trash mr-2"></i> Clear Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Edit Profile</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-profile-form" class="space-y-4">
                <div>
                    <label for="edit-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="edit-name" name="edit-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="Demo User" required>
                </div>
                <div>
                    <label for="edit-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="edit-email" name="edit-email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" value="demo@example.com" required>
                </div>
                <div>
                    <label for="edit-password" class="block text-sm font-medium text-gray-700">New Password (leave blank to keep current)</label>
                    <input type="password" id="edit-password" name="edit-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="edit-confirm-password" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                    <input type="password" id="edit-confirm-password" name="edit-confirm-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="pt-4">
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Complete Payment</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <p class="text-gray-700 mb-2">Total Amount:</p>
                <p class="text-3xl font-bold text-blue-600" id="payment-amount">Rp 0</p>
            </div>
            <form id="payment-form" class="space-y-4">
                <div>
                    <label for="payment-method" class="block text-sm font-medium text-gray-700">Payment Method</label>
                    <select id="payment-method" name="payment-method" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="cash">Cash</option>
                        <option value="card">Credit/Debit Card</option>
                        <option value="digital">Digital Wallet</option>
                    </select>
                </div>
                <div id="cash-payment" class="space-y-4">
                    <div>
                        <label for="cash-received" class="block text-sm font-medium text-gray-700">Cash Received</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">Rp</span>
                            </div>
                            <input type="number" id="cash-received" name="cash-received" class="pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="0">
                        </div>
                    </div>
                    <div>
                        <label for="change-amount" class="block text-sm font-medium text-gray-700">Change</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm">Rp</span>
                            </div>
                            <input type="text" id="change-amount" name="change-amount" class="pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50" readonly>
                        </div>
                    </div>
                </div>
                <div class="pt-4">
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Complete Transaction
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Receipt</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="receipt-content" class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                <div class="text-center mb-4">
                    <h3 class="text-xl font-bold text-gray-900">Pelita X JEP</h3>
                    <p class="text-gray-500">Jl. Sultan Agung 147 Bangorejo - Banyuwangi</p>
                    <p class="text-gray-500">WA : 085335731700</p>
                    <p class="text-gray-500" id="receipt-date">Date: 01/01/2023 12:00 PM</p>
                </div>
                <div class="border-t border-b border-gray-200 py-4 my-4">
                    <div class="space-y-2" id="receipt-items">
                        <!-- Receipt items will be added here -->
                    </div>
                </div>
                <div class="space-y-1 text-right">
                    <p class="text-gray-700">Subtotal: <span id="receipt-subtotal">Rp 0</span></p>
                    <p class="text-gray-700">Discount: <span id="receipt-discount">Rp 0</span></p>
                    <p class="text-lg font-bold">Total: <span id="receipt-total">Rp 0</span></p>
                    <p class="text-gray-700 mt-2">Payment Method: <span id="receipt-payment-method">Cash</span></p>
                    <p class="text-gray-700" id="receipt-cash-received">Cash Received: Rp 0</p>
                    <p class="text-gray-700" id="receipt-change">Change: Rp 0</p>
                </div>
                <div class="text-center mt-6">
                    <p class="text-gray-500">Thank you for your purchase!</p>
                    <p class="text-gray-500">Transaction #<span id="receipt-transaction-id">12345</span></p>
                </div>
            </div>
            <div class="flex justify-center">
                <button type="button" id="print-receipt-btn" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <i class="fas fa-download mr-2"></i> Download Receipt
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="edit-product-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="product-modal-title">Edit Product</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="edit-product-form" class="space-y-4">
                <input type="hidden" id="edit-product-id">
                <div>
                    <label for="edit-product-name" class="block text-sm font-medium text-gray-700">Product Name</label>
                    <input type="text" id="edit-product-name" name="edit-product-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="edit-product-price" class="block text-sm font-medium text-gray-700">Price (Rp)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">Rp</span>
                        </div>
                        <input type="number" id="edit-product-price" name="edit-product-price" class="pl-10 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div>
                    <label for="edit-product-icon" class="block text-sm font-medium text-gray-700">Icon</label>
                    <select id="edit-product-icon" name="edit-product-icon" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="pencil">Pencil</option>
                        <option value="pen">Pen</option>
                        <option value="marker">Marker</option>
                        <option value="eraser">Eraser</option>
                        <option value="paperclip">Paperclip</option>
                        <option value="sticky-note">Sticky Note</option>
                        <option value="book">Notebook</option>
                        <option value="clipboard">Clipboard</option>
                        <option value="ruler">Ruler</option>
                        <option value="scissors">Scissors</option>
                        <option value="tape">Tape</option>
                        <option value="folder">Folder</option>
                    </select>
                </div>
                <div>
                    <label for="edit-product-color" class="block text-sm font-medium text-gray-700">Color Theme</label>
                    <select id="edit-product-color" name="edit-product-color" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="amber">Amber</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="red">Red</option>
                        <option value="purple">Purple</option>
                        <option value="pink">Pink</option>
                        <option value="orange">Orange</option>
                        <option value="indigo">Indigo</option>
                    </select>
                </div>
                <div class="pt-4 flex space-x-3">
                    <button type="submit" class="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Save Product
                    </button>
                    <button type="button" id="delete-product-btn" class="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        Delete
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="user-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800" id="user-modal-title">Add User</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="user-form" class="space-y-4">
                <input type="hidden" id="edit-user-id">
                <div>
                    <label for="user-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                    <input type="text" id="user-name" name="user-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="user-username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="user-username" name="user-username" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="user-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="user-email" name="user-email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="user-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="user-password" name="user-password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <p class="text-xs text-gray-500 mt-1" id="password-hint">Leave blank to keep current password (when editing)</p>
                </div>
                <div>
                    <label for="user-role" class="block text-sm font-medium text-gray-700">Role</label>
                    <select id="user-role" name="user-role" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="Admin">Admin</option>
                        <option value="User">User</option>
                        <option value="Guest">Guest</option>
                    </select>
                </div>
                <div>
                    <label for="user-status" class="block text-sm font-medium text-gray-700">Status</label>
                    <select id="user-status" name="user-status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                        <option value="Suspended">Suspended</option>
                    </select>
                </div>
                <div class="pt-4 flex space-x-3">
                    <button type="submit" class="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" id="save-user-btn">
                        Save User
                    </button>
                    <button type="button" id="delete-user-btn" class="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        Delete
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Confirm Deletion</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <p class="text-gray-700" id="delete-confirm-message">Are you sure you want to delete this item?</p>
            </div>
            <div class="flex space-x-3">
                <button type="button" class="flex-1 flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 modal-close">
                    Cancel
                </button>
                <button type="button" id="confirm-delete-btn" class="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Sync Status Modal -->
    <div id="sync-status-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Synchronization Status</h2>
                <button class="modal-close text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <div class="flex items-center justify-center mb-4">
                    <div id="sync-spinner" class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
                </div>
                <p class="text-gray-700 text-center" id="sync-status-message">Synchronizing data with cloud...</p>
            </div>
            <div class="flex justify-center">
                <button type="button" class="modal-close inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-container" class="fixed top-4 right-4 z-50"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDWCVjbQUiz9S-JI1RywR6gRPnkTwvZteE",
            authDomain: "kasir-app-96531.firebaseapp.com",
            databaseURL: "https://kasir-app-96531-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kasir-app-96531",
            storageBucket: "kasir-app-96531.firebasestorage.app",
            messagingSenderId: "801737538240",
            appId: "1:801737538240:web:daab2677ff5f2872ce0b25"
        };

        let firebaseInitialized = false;
        let database = null;
        let syncEnabled = true;
        let syncInterval = null;
        let lastSyncTime = null;

        // Initialize Firebase
        function initializeFirebase() {
            if (firebaseInitialized) return;
            try {
                firebase.initializeApp(firebaseConfig);
                database = firebase.database();
                firebaseInitialized = true;
                console.log(" Firebase initialized with real database");
            } catch (error) {
                console.error(" Error initializing Firebase:", error);
                showToast("Failed to connect to cloud", "error");
            }
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(amount);
        }

        // Show toast
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `p-3 rounded-md shadow-lg text-white mb-2 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
            }`;
            toast.textContent = message;
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // DOM Elements
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdown = document.getElementById('user-dropdown');
        const logoutButton = document.getElementById('logout-button');
        const registerBtn = document.getElementById('register-btn');
        const modalCloseButtons = document.querySelectorAll('.modal-close');
        const loginScreen = document.getElementById('login-screen');
        const dashboardScreen = document.getElementById('dashboard-screen');
        const userInitial = document.getElementById('user-initial');

        // Sample data
        const defaultUsers = [
            { id: '1', username: 'demo', password: 'password', email: 'demo@example.com', name: 'Demo User', role: 'Admin', status: 'Active', lastUpdated: Date.now() }
        ];
        let users = [];

        const defaultProducts = [
            { id: '1', name: 'Coffee', price: 35000, icon: 'pencil', color: 'amber', lastUpdated: Date.now() },
            { id: '2', name: 'Sandwich', price: 57500, icon: 'pen', color: 'green', lastUpdated: Date.now() }
        ];
        let products = [];

        // Load data
        async function loadDataFromCloud() {
            await loadUsersFromCloud();
            await loadProductsFromCloud();
            renderUsers();
            renderProducts();
            lastSyncTime = Date.now();
            updateLastSyncedTime();
            showToast("Data loaded from cloud", "success");
        }

        async function loadUsersFromCloud() {
            if (!database) return;
            try {
                const snapshot = await database.ref('users').once('value');
                if (snapshot.exists()) users = Object.values(snapshot.val());
                else { users = [...defaultUsers]; await saveUsersToCloud(); }
            } catch (error) {
                console.error("Load users error:", error);
            }
        }

        async function saveUsersToCloud() {
            if (!database) return;
            try {
                const usersObj = {};
                users.forEach(u => usersObj[u.id] = u);
                await database.ref('users').set(usersObj);
                console.log(" Users saved to Firebase");
            } catch (error) {
                console.error(" Save users error:", error);
            }
        }

        async function loadProductsFromCloud() {
            if (!database) return;
            try {
                const snapshot = await database.ref('products').once('value');
                if (snapshot.exists()) products = Object.values(snapshot.val());
                else { products = [...defaultProducts]; await saveProductsToCloud(); }
            } catch (error) {
                console.error("Load products error:", error);
            }
        }

        async function saveProductsToCloud() {
            if (!database) return;
            try {
                const productsObj = {};
                products.forEach(p => productsObj[p.id] = p);
                await database.ref('products').set(productsObj);
                console.log(" Products saved to Firebase");
            } catch (error) {
                console.error(" Save products error:", error);
            }
        }

        // Render functions
        function renderUsers() {
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '';
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${user.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${user.role}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${user.status}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button class="text-blue-600 edit-user-btn" data-id="${user.id}">Edit</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderProducts() {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            products.forEach(p => {
                const div = document.createElement('div');
                div.className = 'bg-white p-4 rounded-lg shadow text-center';
                div.innerHTML = `<h5>${p.name}</h5><p>${formatCurrency(p.price)}</p>`;
                div.onclick = () => addToCart(p);
                grid.appendChild(div);
            });
        }

        function addToCart(product) {
            const cartItem = cart.find(item => item.id === product.id);
            if (cartItem) cartItem.quantity += 1;
            else cart.push({ ...product, quantity: 1 });
            updateCart();
            showToast(`Added ${product.name}`);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            loadDataFromCloud();

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    showDashboard(user);
                    showToast('Login successful!', 'success');
                } else {
                    showToast('Invalid credentials', 'error');
                }
            });

            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('reg-username').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                if (users.some(u => u.username === username)) {
                    showToast('Username exists', 'error');
                    return;
                }
                const newUser = { id: Date.now().toString(), username, password, email, name: username, role: 'User', status: 'Active' };
                users.push(newUser);
                saveUsersToCloud();
                localStorage.setItem('currentUser', JSON.stringify(newUser));
                showDashboard(newUser);
                showToast('Registered!', 'success');
            });

            // More event listeners...
        });

        function showDashboard(user) {
            loginScreen.classList.add('hidden');
            dashboardScreen.classList.remove('hidden');
            userInitial.textContent = user.name.charAt(0).toUpperCase();
        }
    </script>
</body>
</html>
